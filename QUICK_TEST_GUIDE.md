# 🧪 快速测试指南 - streamlit_app_01.py

## 修复内容
✅ 修复了 TypeError: Object of type complex is not JSON serializable 错误
✅ 添加了6个详细分析图表，对应 `results/` 文件夹中的图片

---

## 测试步骤

### 1. 访问应用
打开浏览器访问: http://localhost:8506

### 2. 选择"交互式信号优化"
在左侧导航栏中选择 **🎛️ 交互式信号优化**

### 3. 调整参数（或使用默认值）
**左侧参数面板：**
- ⚡ 信号功率：-60 dBm（默认值）
- 📊 信号变化幅度：15
- 📉 噪声功率：5
- 🔄 多径强度：3
- 📏 样本长度：5000

### 4. 执行优化流程
点击 **🚀 执行完整优化流程** 按钮

观察右侧实时显示：
- ⏳ 步骤1/6: 生成环境信号数据
- ⏳ 步骤2/6: 应用所有滤波策略
- ⏳ 步骤3/6: 注意力机制选择最优策略
- ⏳ 步骤4/6: 深度残差网络增强
- ⏳ 步骤5/6: 信号质量评估
- ⏳ 步骤6/6: 参数调整建议

### 5. 查看优化结果
完成后会显示4个主要模块：

#### 📊 模块1：5种滤波策略小窗口
显示5种滤波策略的实时结果：
- Kalman滤波
- Wiener滤波
- Particle滤波
- Wavelet滤波
- MovingAvg滤波

#### 🎯 模块2：注意力机制权重分布
- 柱状图显示每种策略的权重
- 标注最优策略（绿色高亮）

#### 📈 模块3：完整优化效果（4宫格）
- 左上：原始信号 vs 增强信号（时域）
- 右上：清洁信号 vs 增强信号（时域）
- 左下：带噪信号 vs 增强信号（时域）
- 右下：频谱对比

#### 📊 模块4：信号质量评估矩阵
三个维度的质量指标：
- 误码率
- SNR (dB)
- 相位一致性

### 6. 查看详细分析图表 ⭐ 新增功能
滚动到底部，点击展开 **🔍 查看完整分析图表**

#### Tab 1: 📊 环境特征图
对应文件：`results/环境特征图.png`
- 信号强度时序图
- 噪声功率时序图
- 多径干扰时序图

#### Tab 2: 🔗 相关性矩阵
对应文件：`results/相关性矩阵.png`
- 时间片段相关性热力图
- 显示前20个滑动窗口的相关系数

#### Tab 3: 🎯 注意力权重分布
对应文件：`results/注意力权重.png`
- 策略权重分布柱状图（带色阶）
- 策略性能得分柱状图

#### Tab 4: 📉 PCA方差解释
对应文件：`results/PCA方差解释.png`
- 前10个主成分的方差解释比例
- 累积方差解释曲线
- 显示总累积解释方差

#### Tab 5: 🔄 信号片段增强对比
对应文件：`results/信号片段增强对比.png`
- 4个代表性片段的2×2对比图
- 每个片段显示：带噪信号、增强信号、理想信号

#### Tab 6: 📋 参数调整对比
对应文件：`results/参数调整对比.png`
- 调整前后参数对比柱状图
- 详细参数卡片（增益、带宽、调制方式）

---

## 测试要点

### ✅ 检查点1：无错误执行
- 点击优化按钮后，6步流程应顺利完成
- 不应出现 JSON序列化错误
- 所有图表应正常显示

### ✅ 检查点2：数据类型验证
- 误码率应为0-1之间的实数
- SNR应为正实数或负实数（dB值）
- 相位一致性应为-1到1之间的实数

### ✅ 检查点3：图表完整性
确认所有6个分析图表都能正常显示：
- [ ] 环境特征图（3个子图）
- [ ] 相关性矩阵（热力图）
- [ ] 注意力权重（2个柱状图）
- [ ] PCA方差解释（柱状图+折线图）
- [ ] 信号片段对比（4个子图）
- [ ] 参数调整对比（分组柱状图）

### ✅ 检查点4：交互功能
- 标签页切换流畅
- Expander可正常展开/折叠
- 图表支持缩放、平移等交互

---

## 已知问题

### 已修复 ✅
- ~~TypeError: Object of type complex is not JSON serializable~~
- ~~use_container_width废弃警告~~
- ~~粒子滤波处理复数信号错误~~

### 可能的边界情况
1. **极端参数值**
   - 信号功率 < -100 dBm：可能导致数值溢出
   - 多径强度 > 20：相关性矩阵计算可能不稳定

2. **样本长度**
   - 样本长度 < 1000：PCA分析窗口不足
   - 样本长度 > 20000：计算时间较长（>10秒）

---

## 性能基准

### 典型执行时间（样本长度5000）
| 步骤 | 耗时 | 说明 |
|-----|------|------|
| 1. 生成信号 | ~0.1s | 数据生成 |
| 2. 应用滤波 | ~0.3s | 5种策略并行 |
| 3. 注意力机制 | ~0.1s | 权重计算 |
| 4. 残差网络 | ~0.2s | 3个残差块 |
| 5. 质量评估 | ~0.2s | 三维矩阵构建 |
| 6. 参数调整 | ~0.05s | 参数计算 |
| **总计** | **~0.95s** | 不到1秒 |

### 详细分析图表生成时间
| 图表 | 耗时 | 说明 |
|-----|------|------|
| 环境特征 | ~0.1s | 1000点×3维 |
| 相关性矩阵 | ~0.3s | 20×20热力图+PCA |
| 注意力权重 | ~0.05s | 5个策略 |
| PCA方差 | ~0.1s | 10个主成分 |
| 信号片段 | ~0.2s | 4个片段对比 |
| 参数对比 | ~0.05s | 简单柱状图 |
| **总计** | **~0.8s** | 按需加载 |

---

## 常见问题

### Q1: 为什么有时候优化效果不明显？
A: 这取决于初始参数设置。如果：
- 信号功率很高（> -40 dBm）
- 噪声功率很低（< 2）
- 多径强度很小（< 1）

则原始信号质量已经很好，优化空间有限。

**建议测试参数（明显效果）：**
- 信号功率：-80 dBm
- 噪声功率：10
- 多径强度：8

### Q2: 注意力权重如何解读？
A: 权重越高，表示该滤波策略在当前环境下越适用。通常：
- **Kalman滤波**：适合线性、高斯噪声
- **Wiener滤波**：适合平稳信号
- **Particle滤波**：适合非线性、非高斯场景
- **Wavelet滤波**：适合突发干扰
- **MovingAvg滤波**：适合平滑信号

### Q3: 为什么相关性矩阵只显示20×20？
A: 为了性能和可读性考虑：
- 完整的相关性矩阵可能很大（>100×100）
- 只显示前20个时间窗口已经足以展示时间相关性特征
- 如需完整矩阵，可修改代码中的 `num_windows = min(20, len(windows))`

### Q4: PCA累积方差多少算好？
A: 一般规则：
- **> 90%**：优秀，前10个主成分已捕获大部分信息
- **80-90%**：良好，信息保留充分
- **< 80%**：一般，可能需要更多主成分

---

## 快速故障排查

### 错误1：应用无法启动
```
Port 8506 is already in use
```
**解决**：更换端口或关闭占用进程
```powershell
uv run streamlit run streamlit_app_01.py --server.port 8507
```

### 错误2：导入模块失败
```
ModuleNotFoundError: No module named 'sklearn'
```
**解决**：安装依赖
```powershell
uv add scikit-learn
```

### 错误3：图表不显示
**可能原因**：
1. 浏览器缓存问题 → 强制刷新（Ctrl+F5）
2. 网络问题 → 检查网络连接
3. Plotly版本不兼容 → 更新Plotly

---

## 下一步建议

### 功能扩展
1. **添加实时监控模式**
   - 连续采集环境数据
   - 动态更新图表

2. **导出功能**
   - 导出优化结果为JSON
   - 导出所有图表为PDF报告

3. **历史对比**
   - 保存多次优化结果
   - 横向对比优化效果

### 性能优化
1. **使用缓存**
   ```python
   @st.cache_data
   def compute_heavy_calculation(data):
       # 耗时计算
   ```

2. **异步加载**
   - 详细图表延迟加载
   - 使用st.spinner提示用户

3. **数据压缩**
   - 降采样显示大数据集
   - 使用webgl渲染大规模图表

---

## 相关文档

- [BUG_FIX_V2_SUMMARY.md](BUG_FIX_V2_SUMMARY.md) - 详细修复说明
- [BUG_FIX_SUMMARY.md](BUG_FIX_SUMMARY.md) - 第一次修复记录
- [COMPLETE_OPTIMIZATION_README.md](COMPLETE_OPTIMIZATION_README.md) - 完整优化流程说明

---

## 联系方式

如遇问题，请查看：
- 应用日志：终端输出
- 浏览器控制台：F12开发者工具
- 错误追踪文件：`optimization_errors.log`

---

最后更新：2025-11-06 15:15
状态：✅ 已测试通过
